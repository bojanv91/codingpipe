<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Transformation Pipelines: Solving Complex Data Processing Loops</title>
		<meta name="description" content="Random thoughts about programming and software development">

		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"></link>
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"></link>
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"></link>
		<link rel="manifest" href="/site.webmanifest"></link>
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="CodingPipe.com">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="CodingPipe.com">
		<meta name="generator" content="Eleventy v3.0.0">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;
	--background-color: #fff;
	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;
	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;
		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;
		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}

html {
	overflow-y: scroll;
}

body {
	max-width: 45em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}

p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}

	a[href]:visited {
		color: var(--text-color-link-visited);
	}

	a[href]:hover,
	a[href]:active {
		color: var(--text-color-link-active);
	}

main {
	padding: 1rem;
}

	main :first-child {
		margin-top: 0;
	}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

	header:after {
		content: "";
		display: table;
		clear: both;
	}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}

	table td,
	table th {
		padding-right: 1em;
	}

pre,
code {
	font-family: var(--font-family-monospace);
	font-size: 0.92em !important;
	line-height: 1.3 !important;
}

	pre:not([class*="language-"]) {
		margin: .5em 0;
		line-height: 1.3;
		-moz-tab-size: var(--syntax-tab-size);
		-o-tab-size: var(--syntax-tab-size);
		tab-size: var(--syntax-tab-size);
		-webkit-hyphens: none;
		-ms-hyphens: none;
		hyphens: none;
		direction: ltr;
		text-align: left;
		white-space: pre;
		word-spacing: normal;
		word-break: normal;
		padding: 0.5em 0.8em;
		border-radius: 4px;
	}

code {
	word-break: break-all;
	padding: 0.1em 0.3em;
	border-radius: 3px;
}

/* Header */
header {
	display: flex;
	gap: 1em .5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}

.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}

	.home-link:link:not(:hover) {
		text-decoration: none;
	}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}

.nav-item {
	display: inline-block;
	margin-right: 1em;
}

	.nav-item a[href]:not(:hover) {
		text-decoration: none;
	}

.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	/*list-style: none;*/
	padding: 0;
	/*padding-left: 1.5rem;*/
}

.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	/*counter-increment: start-from -1;*/
	margin-bottom: 1em;
}

	.postlist-item:before {
		/*display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
		line-height: 100%;
		text-align: right;
		margin-left: -1.5rem;*/
	}

	.postlist-date,
	.postlist-item:before {
		font-size: 0.8125em; /* 13px /16 */
		color: var(--color-gray-90);
	}

.postlist-date {
	word-spacing: -0.5px;
	margin-left: auto; /* Push date to the most right position */
	color: var(--color-gray-50);
}

.postlist-link {
	text-decoration: none; /* don't underline the links here */
	font-size: 1em; /*1.1875em;*/ /* 19px /16 */
	font-weight: 400; /* 700 */
	/*flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;*/
}

	.postlist-link:focus,
	.postlist-link:hover {
		text-decoration: underline;
	}

.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	/*text-transform: capitalize;*/
	/*font-style: italic;*/
	text-decoration: none;
}

	.post-tag:focus,
	.post-tag:hover {
		text-decoration: underline;
	}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
	color: var(--color-gray-50);
}

	.post-metadata time {
		/*margin-right: 1em;*/
	}

	.post-metadata .post-tag {
		color: inherit;
	}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: .1em;
}

a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}

	a[href].header-anchor:focus,
	a[href].header-anchor:hover {
		text-decoration: underline;
	}

	a[href].header-anchor:focus,
	:hover > a[href].header-anchor {
		color: #aaa;
	}

h2 + .header-anchor {
	font-size: 1.5em;
}

/*
		***************
		Custom
		***************
*/

h1 {
	margin-bottom: 0;
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">CodingPipe.com</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/links/">Favorite Links</a></li>
					<li class="nav-item"><a href="/tags/">Tags</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>Transformation Pipelines: Solving Complex Data Processing Loops</h1>

<ul class="post-metadata">
	<li><time datetime="2025-04-20">Apr 20, 2025</time></li>
	<li><span> • </span></li>
	<li><span>6 min read</span></li>
	<li><span> • </span></li>
		<li><a href="/tags/programming/" class="post-tag">Programming</a> • </li>
		<li><a href="/tags/patterns/" class="post-tag">Patterns</a></li>
</ul>

<p>Ever encountered a method with a 100+ line loop that does everything at once? These complex loops try to validate data, normalize values, apply business rules, and generate statistics all in one place. As they grow, each new requirement risks breaking existing logic, and testing becomes nearly impossible.</p>
<h2 id="the-problem-complex-loops" tabindex="-1">The Problem: Complex Loops <a class="header-anchor" href="#the-problem-complex-loops">#</a></h2>
<p>Complex loops typically start simple but grow organically as developers add &quot;just one more condition&quot; rather than refactoring. The example below started as basic GPS point processing but expanded with additional steps for elevation tracking, speed calculation, and terrain classification. With each new feature, the code became harder to maintain:</p>
<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token return-type class-name">ActivitySummary</span> <span class="token function">ProcessGpxData</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>GpxPoint<span class="token punctuation">></span></span> gpxPoints<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// State variables</span>
    <span class="token class-name"><span class="token keyword">double</span></span> totalDistance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> totalElevationGain <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>GpxPoint<span class="token punctuation">></span></span> processedPoints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>GpxPoint<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// NOTE: This example has been shortened for brevity while preserving</span>
    <span class="token comment">// the key pattern of a complex loop with multiple responsibilities</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gpxPoints<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> point <span class="token operator">=</span> gpxPoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> prevPoint <span class="token operator">=</span> gpxPoints<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Calculate distance and speed</span>
            <span class="token class-name"><span class="token keyword">double</span></span> segmentDistance <span class="token operator">=</span> <span class="token function">CalculateHaversineDistance</span><span class="token punctuation">(</span>prevPoint<span class="token punctuation">,</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">double</span></span> speed <span class="token operator">=</span> <span class="token function">CalculateSpeed</span><span class="token punctuation">(</span>segmentDistance<span class="token punctuation">,</span> point<span class="token punctuation">.</span>Timestamp <span class="token operator">-</span> prevPoint<span class="token punctuation">.</span>Timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
            <span class="token comment">// Skip GPS errors</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Track elevation changes</span>
            <span class="token class-name"><span class="token keyword">double</span></span> elevationDelta <span class="token operator">=</span> point<span class="token punctuation">.</span>Elevation <span class="token operator">-</span> prevPoint<span class="token punctuation">.</span>Elevation<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elevationDelta <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span>
                totalElevationGain <span class="token operator">+=</span> elevationDelta<span class="token punctuation">;</span>
                
            <span class="token comment">// Update accumulated values</span>
            totalDistance <span class="token operator">+=</span> segmentDistance<span class="token punctuation">;</span>
            
            <span class="token comment">// Update point with calculated metrics</span>
            point<span class="token punctuation">.</span>SegmentDistance <span class="token operator">=</span> segmentDistance<span class="token punctuation">;</span>
            point<span class="token punctuation">.</span>Speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
            
            <span class="token comment">// Apply elevation smoothing (simplified)</span>
            point<span class="token punctuation">.</span>SmoothedElevation <span class="token operator">=</span> <span class="token function">CalculateSmoothedElevation</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> gpxPoints<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Classify terrain (multiple concerns mixed together)</span>
            point<span class="token punctuation">.</span>TerrainType <span class="token operator">=</span> <span class="token function">DetermineTerrainType</span><span class="token punctuation">(</span>elevationDelta<span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Initialize first point</span>
            <span class="token comment">// ...initialization code...</span>
        <span class="token punctuation">}</span>
        
        processedPoints<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActivitySummary</span> 
    <span class="token punctuation">{</span>
        ProcessedPoints <span class="token operator">=</span> processedPoints<span class="token punctuation">,</span>
        TotalDistance <span class="token operator">=</span> totalDistance<span class="token punctuation">,</span>
        <span class="token comment">// Other properties...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>These complex loops create code that:</p>
<ul>
<li>Does too many things at once instead of separating concerns</li>
<li>Resists changes as dependencies are hidden and unclear</li>
<li>Makes unit testing difficult by coupling unrelated operations together</li>
<li>Creates excessive mental load for developers trying to understand it</li>
</ul>
<h2 id="the-solution-transformation-pipelines" tabindex="-1">The Solution: Transformation Pipelines <a class="header-anchor" href="#the-solution-transformation-pipelines">#</a></h2>
<p>The solution is to break down complex processing into a transformation pipeline with discrete steps connected by an intermediate data structure. Each step has a single responsibility and transforms the data in a specific way:</p>
<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">ActivitySummary</span> <span class="token function">ProcessGpxData</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>GpxPoint<span class="token punctuation">></span></span> gpxPoints<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Convert raw GPS points to our working structure</span>
    <span class="token class-name"><span class="token keyword">var</span></span> intermediateData <span class="token operator">=</span> <span class="token function">MapToIntermediateData</span><span class="token punctuation">(</span>gpxPoints<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name"><span class="token keyword">var</span></span> withSegmentMetrics <span class="token operator">=</span> <span class="token function">CalculateSegmentMetrics</span><span class="token punctuation">(</span>intermediateData<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name"><span class="token keyword">var</span></span> filteredPoints <span class="token operator">=</span> <span class="token function">FilterGpsGlitches</span><span class="token punctuation">(</span>withSegmentMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>         
    <span class="token class-name"><span class="token keyword">var</span></span> withElevationData <span class="token operator">=</span> <span class="token function">ProcessElevationData</span><span class="token punctuation">(</span>filteredPoints<span class="token punctuation">)</span><span class="token punctuation">;</span>       
    <span class="token class-name"><span class="token keyword">var</span></span> smoothedData <span class="token operator">=</span> <span class="token function">ApplyDataSmoothing</span><span class="token punctuation">(</span>withElevationData<span class="token punctuation">)</span><span class="token punctuation">;</span>           
    <span class="token class-name"><span class="token keyword">var</span></span> enrichedData <span class="token operator">=</span> <span class="token function">ClassifyTerrainTypes</span><span class="token punctuation">(</span>smoothedData<span class="token punctuation">)</span><span class="token punctuation">;</span>              
    <span class="token class-name"><span class="token keyword">var</span></span> processedPoints <span class="token operator">=</span> <span class="token function">CalculateAccumulatedTotals</span><span class="token punctuation">(</span>enrichedData<span class="token punctuation">)</span><span class="token punctuation">;</span>     
    
    <span class="token comment">// Create final output with statistics</span>
    <span class="token keyword">return</span> <span class="token function">GenerateActivitySummary</span><span class="token punctuation">(</span>processedPoints<span class="token punctuation">)</span><span class="token punctuation">;</span>                    
<span class="token punctuation">}</span></code></pre>
<p>Each step has a single responsibility and can be implemented, tested, and modified independently. The key to making this work is an intermediate data structure that carries accumulated state between processing steps:</p>
<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">GpxIntermediateData</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Original data</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Latitude <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Longitude <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Elevation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token comment">// Derived/accumulated data</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> SegmentDistance <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Speed <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> ElevationDelta <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsGpsGlitch <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> SmoothedElevation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> TerrainType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> AccumulatedDistance <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> AccumulatedElevationGain <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> AccumulatedElevationLoss <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details">#</a></h2>
<p>Let's see how some of the pipeline steps would be implemented:</p>
<pre class="language-csharp" tabindex="0"><code class="language-csharp"><span class="token comment">// Step 1: Map input to intermediate structure</span>
<span class="token keyword">private</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>GpxIntermediateData<span class="token punctuation">></span></span> <span class="token function">MapToIntermediateData</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>GpxPoint<span class="token punctuation">></span></span> gpxPoints<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> gpxPoints<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GpxIntermediateData</span>
    <span class="token punctuation">{</span>
        Latitude <span class="token operator">=</span> p<span class="token punctuation">.</span>Latitude<span class="token punctuation">,</span>
        Longitude <span class="token operator">=</span> p<span class="token punctuation">.</span>Longitude<span class="token punctuation">,</span>
        Elevation <span class="token operator">=</span> p<span class="token punctuation">.</span>Elevation<span class="token punctuation">,</span>
        Timestamp <span class="token operator">=</span> p<span class="token punctuation">.</span>Timestamp
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Step 3: Filter out GPS glitches based on unreasonable speeds</span>
<span class="token keyword">private</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>GpxIntermediateData<span class="token punctuation">></span></span> <span class="token function">FilterGpsGlitches</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>GpxIntermediateData<span class="token punctuation">></span></span> points<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Mark points with unreasonable speed as glitches</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> point <span class="token keyword">in</span> points<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        point<span class="token punctuation">.</span>IsGpsGlitch <span class="token operator">=</span> point<span class="token punctuation">.</span>Speed <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// 30 m/s threshold</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Filter out glitches</span>
    <span class="token keyword">return</span> points<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token operator">!</span>p<span class="token punctuation">.</span>IsGpsGlitch<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Step 5: Apply smoothing to elevation data</span>
<span class="token keyword">private</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>GpxIntermediateData<span class="token punctuation">></span></span> <span class="token function">ApplyDataSmoothing</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>GpxIntermediateData<span class="token punctuation">></span></span> points<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Skip if not enough points for smoothing</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">.</span>Count <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> points<span class="token punctuation">;</span>
        
    <span class="token comment">// Apply a simple moving average window</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> points<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simple 3-point moving average smoothing</span>
        points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>SmoothedElevation <span class="token operator">=</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Elevation <span class="token operator">+</span> 
                                      points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Elevation <span class="token operator">+</span> 
                                      points<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Elevation<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> points<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="benefits-of-the-pipeline-approach" tabindex="-1">Benefits of the Pipeline Approach <a class="header-anchor" href="#benefits-of-the-pipeline-approach">#</a></h2>
<ul>
<li>Each step can be tested independently</li>
<li>Changes affect only single functions, not the entire process</li>
<li>Pipeline steps clearly document the transformation sequence</li>
<li>Issues can be isolated to specific steps</li>
<li>Functions can be reused in other systems</li>
<li>New steps can be added without changing existing code</li>
</ul>
<p>Creating intermediate data structures improves code clarity, which is often worth the small performance cost in most applications.</p>
<h2 id="related-patterns-and-principles" tabindex="-1">Related Patterns and Principles <a class="header-anchor" href="#related-patterns-and-principles">#</a></h2>
<p>This approach leverages several established patterns:</p>
<ul>
<li><strong>Pipes and Filters.</strong> Connected processing steps with data flowing between them</li>
<li><strong>Single Responsibility Principle.</strong> Each step has one reason to change</li>
<li><strong>Map-Reduce.</strong> Map raw data to workable form, transform it, reduce to output</li>
</ul>
<p>Unlike distributed implementations of these patterns, our approach applies them at method level for everyday code.</p>
<h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion">#</a></h2>
<p>When you spot a loop doing too much (tracking state, applying business rules, and formatting output simultaneously), consider refactoring it to a data transformation pipeline.</p>
<p>Don't try to do everything at once. Divide problems into subproblems, solve them independently, then merge them in the final solution.</p>
<p>Next time you encounter such a complex loop:</p>
<ol>
<li>Identify each distinct operation being performed</li>
<li>Design an intermediate data structure that can carry all necessary state</li>
<li>Create single-purpose functions for each transformation step</li>
<li>Chain them together in a clear sequence</li>
<li>Write tests for each independent step</li>
</ol>
<p>This approach improves code quality and makes future maintenance easier.</p>

<ul class="links-nextprev"><li>Previous: <a href="/posts/serilog-correlationid-background-task/">Correlation IDs with Serilog in ASP.NET Core Background Tasks</a></li><li>Next: <a href="/posts/power-of-prototyping/">The Power of Prototyping in Unfamiliar Codebases</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- This page `/posts/transformation-pipelines-solving-complex-data-processing-loops/` was built on 2025-04-22T22:00:56.900Z -->

		<!-- Google tag (gtag.js) -->
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-E6F7C4Q881"></script>
		<script>
			if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
    			console.log('Running on localhost, skipping Google Analytics.');
			} else {
				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());

				gtag('config', 'G-E6F7C4Q881');
			}
		</script>
	</body>
</html>
